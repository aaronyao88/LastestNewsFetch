import { NextResponse } from 'next/server';
import { translateNewsItem } from '@/services/translator';
import { NewsItem } from '@/types';

export async function GET() {
    const longEnglishSummary = `
        Black Friday is the most anticipated day of the year for bargain hunters. While there’s still some time to go before November 28th, we’ve already found a healthy selection of early discounts, allowing you to get a jump on your holiday shopping. Right now, for instance, the new AirPods Pro 3 are receiving their first sizable discount. Meanwhile, Google’s Pixel Watch 4 — the Android watch to beat — is on sale for the first time. However, that’s just a taste of what’s to come in November. As the month goes on, we’re expecting to see even more deals — including sizable drops on robovacs, TVs, and headphones. In fact, retailers like Amazon, Walmart, Best Buy, and Target have already kicked off their holiday promos. We’ll be updating this guide over the next week or so, too, so be sure to check back as we approach the main event. Apple deals Headphone and earbud deals Smartwatch and fitness tracker deals Tablet and e-reader deals TV and streaming deals Smart home deals Soundbar and speaker deals Gaming deals Miscellaneous deals Apple deals AirPods Pro 3 The recently released AirPods Pro 3 have a new design that improves their fit, superior noise cancellation, better bass, and fairly accurate heart rate sensors. Read our review. Where to Buy: $249 $219.99 at Amazon $249.99 $219.99 at Best Buy $219.99 $219.99 at Target Apple AirTags Apple’s AirTags are unobtrusive, waterproof, and tap into the massive Find My network for out-of-range locating. Read our original review. Where to Buy: $29 $18 at Amazon $99 $64.99 at Amazon (four-pack) $29 $18 at Walmart AirPods Pro (second-gen with USB-C) The second-gen AirPods Pro improve upon Apple’s original pair with much better noise cancellation, sound quality, and onboard volume controls. The latest refresh also ships with a USB-C charging case, as opposed to Lightning. Read our review. Where to Buy: $249.99 $139 at Walmart Amazon, Walmart, and Target have marked the AirPods 4 down to $79.99 ($20 off), which is the lowest price to date. Apple’s latest open-ear buds have a more comfortable fit than their predecessors and sound a bit better, too, with richer bass performance. Read our review. Where to Buy: $129 $119 at Amazon $129 $119 at Best Buy $129 $119 at B&H Photo iPad Air (11-inch, M2) The 11-inch iPad Air is a great tablet for most people, with a fast M2 chip, a landscape-oriented front camera, and support for the new Apple Pencil Pro. Read our review. Where to Buy: $599 $499 at Amazon $599 $499 at Best Buy $599 $499 at Walmart iPad Air (13-inch, M2) The 13-inch iPad Air is a great tablet for most people, with a fast M2 chip, a landscape-oriented front camera, and support for the new Apple Pencil Pro. Read our review. Where to Buy: $799 $699 at Amazon $799 $699 at Best Buy $799 $699 at Walmart iPad Pro (11-inch, M4) The 11-inch iPad Pro is the best tablet you can buy, with a stunning OLED display, a ridiculously fast M4 chip, and a painfully thin design. Read our review. Where to Buy: $999 $899 at Amazon $999 $899 at Best Buy $999 $899 at Walmart iPad Pro (13-inch, M4) The 13-inch iPad Pro is the best tablet you can buy, with a stunning OLED display, a ridiculously fast M4 chip, and a painfully thin design. Read our review. Where to Buy: $1,299 $1,199 at Amazon $1,299 $1,199 at Best Buy $1,299 $1,199 at Walmart MacBook Air (13-inch, M3) The 13-inch MacBook Air is the best laptop for most people, with a fast M3 chip, a great keyboard and trackpad, and a long-lasting battery. Read our review. Where to Buy: $1,099 $899 at Amazon $1,099 $899 at Best Buy $1,099 $899 at Walmart MacBook Air (15-inch, M3) The 15-inch MacBook Air is the best laptop for most people, with a fast M3 chip, a great keyboard and trackpad, and a long-lasting battery. Read our review. Where to Buy: $1,299 $1,099 at Amazon $1,299 $1,099 at Best Buy $1,299 $1,099 at Walmart MacBook Pro (14-inch, M3) The 14-inch MacBook Pro is a great laptop for creative professionals, with a fast M3 chip, a stunning Mini LED display, and plenty of ports. Read our review. Where to Buy: $1,599 $1,399 at Amazon $1,599 $1,399 at Best Buy $1,599 $1,399 at Walmart MacBook Pro (16-inch, M3) The 16-inch MacBook Pro is a great laptop for creative professionals, with a fast M3 chip, a stunning Mini LED display, and plenty of ports. Read our review. Where to Buy: $2,499 $2,299 at Amazon $2,499 $2,299 at Best Buy $2,499 $2,299 at Walmart Mac mini (M2) The Mac mini is a great desktop for most people, with a fast M2 chip and a compact design. Read our review. Where to Buy: $599 $499 at Amazon $599 $499 at Best Buy $599 $499 at Walmart Mac Studio (M2 Max) The Mac Studio is a great desktop for creative professionals, with a fast M2 Max chip and plenty of ports. Read our review. Where to Buy: $1,999 $1,799 at Amazon $1,999 $1,799 at Best Buy $1,999 $1,799 at Walmart Studio Display The Studio Display is a great monitor for Mac users, with a 5K resolution, a built-in webcam and speakers, and a sleek design. Read our review. Where to Buy: $1,599 $1,399 at Amazon $1,599 $1,399 at Best Buy $1,599 $1,399 at Walmart Magic Keyboard for iPad Pro (11-inch) The Magic Keyboard is the best keyboard case for the iPad Pro, with a great typing experience and a built-in trackpad. Read our review. Where to Buy: $299 $249 at Amazon $299 $249 at Best Buy $299 $249 at Walmart Magic Keyboard for iPad Pro (13-inch) The Magic Keyboard is the best keyboard case for the iPad Pro, with a great typing experience and a built-in trackpad. Read our review. Where to Buy: $349 $299 at Amazon $349 $299 at Best Buy $349 $299 at Walmart Apple Pencil (2nd generation) The Apple Pencil is the best stylus for the iPad, with pressure sensitivity, tilt support, and magnetic charging. Read our review. Where to Buy: $129 $79 at Amazon $129 $79 at Best Buy $129 $79 at Walmart Apple Pencil (USB-C) The Apple Pencil (USB-C) is a cheaper alternative to the 2nd-gen Pencil, but it lacks pressure sensitivity and magnetic charging. Read our review. Where to Buy: $79 $69 at Amazon $79 $69 at Best Buy $79 $69 at Walmart Apple TV 4K (3rd generation) The Apple TV 4K is the best streaming device you can buy, with a fast processor, a great remote, and support for Dolby Vision and HDR10+. Read our review. Where to Buy: $129 $124 at Amazon $129 $124 at Best Buy $129 $124 at Walmart HomePod (2nd generation) The HomePod is a great smart speaker for Apple users, with excellent sound quality and support for Siri. Read our review. Where to Buy: $299 $284 at Amazon $299 $284 at Best Buy $299 $284 at Walmart HomePod mini The HomePod mini is a great smart speaker for Apple users, with good sound quality and support for Siri. Read our review. Where to Buy: $99 $94 at Amazon $99 $94 at Best Buy $99 $94 at Walmart
    `;

    const mockItem: NewsItem = {
        id: 'test-1',
        title: 'The best early Black Friday deals we’ve found so far on laptops, TVs, and more',
        summary: longEnglishSummary,
        url: 'https://example.com',
        source: 'The Verge',
        category: 'Technology',
        publishDate: new Date().toISOString(),
        comments: [],
        heatIndex: 5000
    };

    console.log('Starting translation test...');
    const startTime = Date.now();
    const translatedItem = await translateNewsItem(mockItem);
    const duration = Date.now() - startTime;

    return NextResponse.json({
        originalLength: mockItem.summary.length,
        translatedLength: translatedItem.summary.length,
        duration: `${duration}ms`,
        isChinese: /[\u4e00-\u9fa5]/.test(translatedItem.summary),
        result: translatedItem
    });
}
